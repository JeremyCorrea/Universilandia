import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import DefaultInput from "../components/forms/DefaultInput";
import Gatito from "../assets/sgv/gato-con-pc.svg";
import SocialButton from "../components/forms/SocialButton";
import PublicLayout from "../layouts/PublicLayout";
import Title from "../components/auth/Title";
import { loginSchema } from "../validation/authSchemas";

export default function LoginPage() {
  const [correo, setCorreo] = useState("");
  const [password, setPassword] = useState("");
  const { login, loading, error } = useAuth();
  const navigate = useNavigate();

  const [formErrors, setFormErrors] = useState<{
    correo?: string;
    password?: string;
  }>({});

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    // const success = await login(correo, password);
    // if (success) {
    //   navigate("/");
    // }

    // Validación Yup
    try {
      await loginSchema.validate({ correo, password }, { abortEarly: false });
      setFormErrors({});
    } catch (err: any) {
      if (err?.inner?.length) {
        const collected: Record<string, string> = {};
        err.inner.forEach((e: any) => {
          if (e?.path && !collected[e.path]) collected[e.path] = e.message;
        });
        setFormErrors(collected);
      }
      return;
    }

    const success = await login(correo, password);
    if (success) navigate("/");
  };

  return (
    <PublicLayout>
      <main className="min-h-screen flex items-start justify-center overflow-y-auto py-8">
        <div className="flex flex-col xl:flex-row items-center justify-center gap-[60px] px-4 xl:px-6">
          {/* Columna izquierda formulario */}
          <div className="w-full max-w-[350px] sm:max-w-[740px] flex flex-col justify-center">
            {/* Bloque Titular*/}
            <Title title="¡Hola!" subtitle="Entra en tu cuenta" />

            {/* Formulario */}
            <form
              onSubmit={handleLogin}
              className="w-full max-w-[580px] mx-auto"
            >
              <div className="mb-4">
                <DefaultInput
                  label="Email"
                  type="email"
                  value={correo}
                  onChange={e => setCorreo(e.target.value)}
                />
                {formErrors.correo && (
                  <p className="text-red-600 text-sm mt-1">
                    {formErrors.correo}
                  </p>
                )}
              </div>

              <div className="mb-6">
                <DefaultInput
                  label="Contraseña"
                  type="password"
                  value={password}
                  onChange={e => setPassword(e.target.value)}
                />
                {formErrors.password && (
                  <p className="text-red-600 text-sm mt-1">
                    {formErrors.password}
                  </p>
                )}
              </div>

              {error && (
                <div className="text-red-600 font-medium mb-4 text-center">
                  {error}
                </div>
              )}

              <div className="flex justify-end">
                <a
                  href="#"
                  className="mb-3 mt-[-12px] font-semibold text-[18px] hover:underline"
                >
                  ¿Olvidaste tu contraseña?
                </a>
              </div>

              <div className="flex justify-center">
                <button
                  type="submit"
                  disabled={loading}
                  className="max-w-44 w-full p-3 bg-black text-white rounded-full font-semibold text-[20px]"
                >
                  {loading ? "Ingresando..." : "Ingresar"}
                </button>
              </div>
            </form>

            {/* Separador */}
            <div className="flex items-center gap-4 my-8 w-full mx-auto">
              <hr className="flex-1 border-t border-black" />
              <span className="text-xl font-semibold">o</span>
              <hr className="flex-1 border-t border-black" />
            </div>

            {/* Bloque Sign In (Google, Facebook, Apple)*/}
            <div className="w-full sm:w-[580px] flex flex-col gap-4 mx-auto">
              <SocialButton
                icon={
                  <svg
                    className="w-6 h-6"
                    viewBox="0 0 41 41"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_4_3668)">
                      <path
                        d="M0 21.8031C0 20.9506 0 20.0964 0 19.244C0.0486239 18.8755 0.0972478 18.5087 0.144195 18.1402C0.88026 12.3135 3.59481 7.59881 8.29121 4.09338C14.9141 -0.850739 23.7016 -1.37831 30.8141 2.85735C37.3599 6.75637 40.7619 12.6417 40.9899 20.2606C41.1157 24.4493 39.947 28.3283 37.6014 31.8069C34.3419 36.6388 29.8249 39.6116 24.0772 40.6819C23.321 40.8225 22.5497 40.8946 21.7869 41.0001C20.9317 41.0001 20.0783 41.0001 19.2232 41.0001C19.1209 40.9783 19.0186 40.9431 18.9164 40.9348C14.832 40.6098 11.155 39.2114 7.93575 36.684C3.79099 33.4298 1.23236 29.2042 0.306834 24.0122C0.176052 23.2803 0.100601 22.54 0 21.8031ZM26.6794 22.7645C26.6492 23.3138 26.3759 24.0407 25.9953 24.6386C24.6322 26.7807 21.926 27.5277 19.6591 27.1157C17.1089 26.6518 15.3685 25.1243 14.5251 22.6991C13.6734 20.2505 14.1613 17.9778 15.8732 16.0283C18.3195 13.243 22.4257 13.1509 24.8485 15.3533C24.8938 15.3952 24.9541 15.4203 24.9239 15.4019C25.9786 14.3652 26.9997 13.3603 28.0359 12.342C27.9537 12.2666 27.8598 12.1745 27.7592 12.0891C25.1318 9.88161 22.0937 9.07267 18.7554 9.72418C14.2803 10.5984 11.2958 13.2966 10.1205 17.6897C8.94847 22.0661 10.1859 25.8797 13.5946 28.8759C16.1951 31.1621 19.307 31.8856 22.704 31.3614C25.4186 30.9427 27.6603 29.6782 29.2883 27.4339C30.6582 25.548 31.245 23.3975 31.292 21.0963C31.3088 20.2237 31.2031 19.3495 31.1511 18.4702C27.6318 18.4702 24.208 18.4702 20.7708 18.4702C20.7708 19.9055 20.7708 21.3191 20.7708 22.7594C22.761 22.7645 24.7194 22.7645 26.6794 22.7645Z"
                        fill="black"
                      />
                      <path
                        d="M26.6794 22.7644C24.7194 22.7644 22.761 22.7644 20.7674 22.7644C20.7674 21.324 20.7674 19.9088 20.7674 18.4751C24.2046 18.4751 27.6284 18.4751 31.1478 18.4751C31.1981 19.3544 31.3054 20.2287 31.2886 21.1013C31.2433 23.4025 30.6548 25.553 29.285 27.4388C27.6552 29.6831 25.4152 30.9459 22.7006 31.3663C19.3037 31.8906 16.1917 31.167 13.5912 28.8809C10.1825 25.8846 8.94509 22.071 10.1171 17.6946C11.2925 13.3015 14.277 10.6034 18.752 9.72912C22.092 9.07593 25.1285 9.88655 27.7558 12.094C27.8564 12.1794 27.9503 12.2715 28.0325 12.3469C26.998 13.3652 25.9752 14.3701 24.9206 15.4068C24.9507 15.4252 24.892 15.4001 24.8451 15.3582C22.424 13.1542 18.3161 13.2463 15.8698 16.0332C14.1579 17.9827 13.67 20.2555 14.5218 22.7041C15.3651 25.1276 17.1055 26.6567 19.6558 27.1206C21.9226 27.5326 24.6305 26.7857 25.992 24.6435C26.3759 24.0389 26.6492 23.3137 26.6794 22.7644Z"
                        fill="white"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_4_3668">
                        <rect width="41" height="41" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                }
                label="Continuar con Google"
              />

              <SocialButton
                icon={
                  <svg
                    className="w-6 h-6"
                    viewBox="0 0 40 41"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M23.8911 40.711C23.8911 35.8301 23.8911 30.9866 23.8911 26.1006C25.1895 26.1006 26.4762 26.1006 27.7996 26.1006C28.0963 24.1802 28.3863 22.2955 28.688 20.3479C26.6895 20.3479 24.7378 20.3479 22.746 20.3479C22.746 19.2823 22.7394 18.2711 22.7494 17.2616C22.7544 16.7704 22.741 16.2708 22.8244 15.7898C23.0577 14.4472 23.9194 13.6094 25.2628 13.5142C26.5095 13.4259 27.7629 13.4548 29.013 13.431C29.1713 13.4276 29.3296 13.431 29.508 13.431C29.508 11.7417 29.508 10.0915 29.508 8.3869C28.7646 8.29682 28.0229 8.18636 27.2762 8.12178C25.6378 7.98072 23.9978 7.86855 22.3827 8.31382C19.4542 9.12277 17.7158 11.0772 17.2808 14.1057C17.0708 15.5723 17.1408 17.0797 17.0958 18.5702C17.0791 19.1412 17.0925 19.7139 17.0925 20.3224C15.5841 20.3224 14.109 20.3224 12.6023 20.3224C12.6023 22.2513 12.6023 24.1445 12.6023 26.0734C14.079 26.0734 15.5524 26.0734 17.0591 26.0734C17.0591 30.9611 17.0591 35.8131 17.0591 40.728C16.4708 40.604 15.8774 40.5122 15.3041 40.3541C7.85542 38.3097 2.88855 33.5698 0.781794 26.0122C-2.04832 15.8697 3.02689 5.38901 12.5756 1.4802C21.681 -2.24676 32.2331 1.19639 37.3683 10.3073C39.7451 14.5237 40.4518 19.0528 39.7284 23.8522C38.4534 32.319 31.8364 38.9402 24.1344 40.6771C24.0711 40.6923 24.0044 40.6957 23.8911 40.711Z"
                      fill="black"
                    />
                    <path
                      d="M23.8909 40.711C23.8909 35.8301 23.8909 30.9865 23.8909 26.1005C25.1892 26.1005 26.476 26.1005 27.7993 26.1005C28.096 24.1801 28.386 22.2954 28.6877 20.3478C26.6893 20.3478 24.7376 20.3478 22.7458 20.3478C22.7458 19.2822 22.7391 18.271 22.7491 17.2615C22.7541 16.7704 22.7408 16.2707 22.8241 15.7898C23.0575 14.4472 23.9192 13.6093 25.2626 13.5142C26.5093 13.4258 27.7627 13.4547 29.0127 13.4309C29.1711 13.4275 29.3294 13.4309 29.5078 13.4309C29.5078 11.7416 29.5078 10.0914 29.5078 8.38684C28.7644 8.29676 28.0227 8.1863 27.276 8.12172C25.6376 7.98066 23.9975 7.86849 22.3825 8.31376C19.454 9.12271 17.7156 11.0771 17.2806 14.1056C17.0706 15.5722 17.1406 17.0797 17.0956 18.5701C17.0789 19.1412 17.0922 19.7139 17.0922 20.3223C15.5838 20.3223 14.1088 20.3223 12.6021 20.3223C12.6021 22.2512 12.6021 24.1444 12.6021 26.0733C14.0788 26.0733 15.5522 26.0733 17.0589 26.0733C17.0589 30.9611 17.0589 35.8131 17.0589 40.728C21.2391 41.3551 24.0042 40.6957 23.8909 40.711Z"
                      fill="white"
                    />
                  </svg>
                }
                label="Continuar con Facebook"
              />

              <SocialButton
                icon={
                  <svg
                    className="w-6 h-6"
                    viewBox="0 0 40 40"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M40 20.0099C39.9934 31.0392 31.0424 39.9918 20.0099 40C8.97243 40.0099 -0.00984089 31.0277 8.09176e-06 19.9885C0.00985707 8.93782 8.97736 -0.0114898 20.0312 1.10725e-05C31.0588 0.0115119 40.0066 8.97726 40 20.0099ZM29.7833 13.7173C28.6047 12.2369 27.1848 11.2774 25.2758 11.1558C23.9954 11.0737 22.8004 11.4302 21.6218 11.8492C20.5713 12.2221 19.5371 12.2796 18.4685 11.9264C17.871 11.7292 17.2538 11.588 16.6382 11.4532C13.7213 10.8158 11.4166 11.8722 9.97374 14.4911C9.20881 15.8794 8.91662 17.3844 8.8723 18.9469C8.805 21.3637 9.41235 23.631 10.4531 25.7915C11.1605 27.262 11.9764 28.6684 13.1336 29.8398C13.8083 30.5217 14.5765 31.054 15.5647 31.1558C16.3526 31.238 17.088 30.9883 17.7856 30.6761C19.3089 29.9926 20.8224 29.9877 22.3621 30.5989C22.6986 30.732 23.0516 30.819 23.3963 30.9291C24.7751 31.3727 25.9586 31.0178 26.9944 30.0501C28.1106 29.0068 28.9084 27.7319 29.5978 26.3879C29.9557 25.6896 30.2397 24.9536 30.5516 24.2488C28.3437 23.212 27.2226 21.5066 27.0207 19.2015C26.8139 16.8307 28.022 15.1302 29.7833 13.7173ZM24.565 5.29862C22.9449 5.68637 21.502 6.32877 20.5696 7.79267C19.8391 8.94111 19.5026 10.1947 19.5108 11.5551C22.4376 11.5732 25.3693 7.94218 24.565 5.29862Z"
                      fill="black"
                    />
                    <path
                      d="M29.7833 13.7173C28.0203 15.1303 26.8138 16.8324 27.0206 19.2016C27.2225 21.5067 28.342 23.2121 30.5515 24.2488C30.2396 24.9537 29.9556 25.6897 29.5978 26.388C28.9084 27.7319 28.1122 29.0069 26.9944 30.0502C25.9586 31.0179 24.7751 31.3728 23.3962 30.9292C23.0515 30.8175 22.6969 30.732 22.3621 30.5989C20.824 29.9878 19.3105 29.9927 17.7856 30.6762C17.0879 30.9883 16.3542 31.2381 15.5646 31.1559C14.5765 31.0524 13.8082 30.5217 13.1336 29.8399C11.9747 28.6684 11.1605 27.262 10.453 25.7916C9.41231 23.6311 8.80495 21.3637 8.87225 18.9469C8.91657 17.3844 9.20876 15.8795 9.9737 14.4912C11.4166 11.8722 13.7212 10.8142 16.6382 11.4533C17.2537 11.588 17.8726 11.7293 18.4684 11.9265C19.5371 12.2797 20.5712 12.2222 21.6218 11.8492C22.8004 11.4303 23.9954 11.0738 25.2757 11.1559C27.1848 11.2775 28.6047 12.237 29.7833 13.7173Z"
                      fill="white"
                    />
                    <path
                      d="M24.5651 5.29858C25.3678 7.94214 22.4361 11.5731 19.511 11.5567C19.5011 10.1963 19.8376 8.94107 20.5697 7.79427C21.5021 6.32873 22.945 5.68633 24.5651 5.29858Z"
                      fill="white"
                    />
                  </svg>
                }
                label="Continuar con Apple"
              />
            </div>
          </div>

          {/* Columna derecha imagen */}
          <img
            src={Gatito}
            alt="Gatito con un computador"
            className="w-[300px] max-w-full max-h-[40vh] object-contain xl:w-[558px] xl:max-h-[85vh]"
          />
        </div>
      </main>
    </PublicLayout>
  );
}
